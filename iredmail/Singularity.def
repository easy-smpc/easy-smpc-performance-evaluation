#WARNING Singularity doesn't support expansion, * found in ./ssl/*
#WARNING ./ssl/* doesn't exist, ensure exists for build
Bootstrap: docker
From: iredmail/mariadb:stable
Stage: spython-base

%files
easysmpc.eval.jar /root/easy-smpc
createEval.sh /root/
#startUp.sh .
dovecot.conf /etc/dovecot
main.cf /etc/postfix
master.cf /etc/postfix
./ssl/* /opt/iredmail/ssl/

%post
# Get JDK
cd /opt
curl https://download.java.net/java/GA/jdk14.0.2/205943a0976c4ed48cb16f1043c5c647/12/GPL/openjdk-14.0.2_linux-x64_bin.tar.gz -o ./openjdk-14.0.2_linux-x64_bin.tar.gz
tar -xf openjdk-14.0.2_linux-x64_bin.tar.gz
chmod +x /entrypoint.sh

# EXPOSE ports
# EXPOSE 80
# EXPOSE 443
# EXPOSE 110
# EXPOSE 995
# EXPOSE 143
# EXPOSE 993
# EXPOSE 25
# EXPOSE 465
# EXPOSE 587
# Define entrypoint and cmd
# CMD /root/createEval.sh
%environment
export HOSTNAME=mail.easysmpc.org
export FIRST_MAIL_DOMAIN=easysmpc.org
export FIRST_MAIL_DOMAIN_ADMIN_PASSWORD=12345
export MLMMJADMIN_API_TOKEN=12345
export ROUNDCUBE_DES_KEY=12345
export USE_IREDAPD=NO
export USE_ANTISPAM=NO
export USE_FAIL2BAN=NO
export USE_ROUNDCUBE=NO
export USE_IREDADMIN=NO
export LANGUAGE=en_US.UTF-8
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8




%runscript
locale-gen en_US.UTF-8
exec /entrypoint.sh bash -c /root/createEval.sh
exec /bin/bash "$@"
%startscript
cd /root
exec /bin/bash "$@"
